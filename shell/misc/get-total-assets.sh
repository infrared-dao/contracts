#!/bin/bash

# Set RPC URL (update this to your node provider)
RPC_URL="https://rpc.berachain.com"

IBERA="0x9b6761bf2397Bb5a6624a856cC84A3A14Dcd3fe5"

# List of vault addresses 
ADDRESSES=(
    "0x79fb77363bb12464ca735B0186B4bd7131089A96"
    "0x59945C5bE54FF1d8dEb0E8bC7F132F950DA910a2"
    "0xd8c53e0E7CF3eCFE642a03A30EC30681eF4159a9"
    "0xA95Ff8097B0E405d1F4139F460fa4c89863784c0"
    "0x5614314Eef828c747602a629B1d974a3f28fF6E2"
    "0x4EF0c533D065118907f68e6017467Eb05DBb2c8C"
    # "0x47590f8c83bb99ff9C9d6640F007722A79f0Ab02"
    # "0xFe7A781914525e7e7c93b30C213FBfcdE1C5F575"
    # "0xC6B6B099CfbCBC3d23ea9Abfe4DA500134479a29"
    # "0xa63fF996cc93bD4E0623F5038ad31D1146aE4f88"
    # "0x4FCE306384228D708E63b6300F4eE3357CF64444"
    # "0x04edCC9715445dd38f9fb327af8740BdFb81b739"
    # "0x58b61ed5c1657e78fFc7E574e8AC42c6f20ebE1E"
    # "0xA2b10d1eE0C0F715eF0694E25984d01Ac8bf83D4"
    # "0x7f6ed59799d4cFAc23d20B623974e9Fca287da17"
    # "0x79A27A5B2A84B60E2869Dd09c46d537B1a6f4EF8"
    # "0xCC0C3F6c8C7a9a7c7788D85Ff720830f8aF6d05c"
    # "0x9F898E9c5863A13f68A714044D380E9ffFf7B732"
    # "0xe193336621B91D9034a7668fD5fE0065AD84f34f"
    # "0x6e0D09B502c6e561B287Cd4e66C8eF879c86E20D"
    # "0x03c2ef90eC1F5deAb5A16aCCFb49C42ac602Ba65"
    # "0xb065F887f23D3707386b3fdfecB252E3C50F5088"
    # "0xbc44617088aeaafAcdEb6dE68CFa287fB2CDa130"
    # "0x2415FEE8Af7c121e17Ae1B78E0891a8C6112CF8f"
    # "0x021f62D74f97f63575f8C608Ab7cC3C591ecCB0d"
    # "0xf4c35f3A334cA73a229D9d416924f51675240796"
    # "0xb59aa6e935C66eea5dEDc0EB385CEB62fbE85757"
    # "0xA3a376E370666d0C3e10A5b1067095F2F080f26f"
    # "0x81ba24b92B162ba56c622b4b80E4CE26426F490A"
    # "0x2E113998f4561Cc15543C380b0A92C60657aE031"
    # "0xde747203c338993fBea53C61e5B2F558c4687958"
    # "0x9433cCf93aC084f7191b78d7BD0e7D64Ed344e27"
    # "0xD10759bD1Ebd69A4e0873DC3c08c43cfF1f166F4"
    # "0x3904AAa585d846096FcDB38ef516C3EBace1ab84"
    # "0xbf19612f6eF35Fe411801509e4c284647213f5FE"
    # "0x7EF1f9F4e6e2F8f112b953f3b0A71ED1311F4730"
    # "0xF3A956b2C29F5c1216A72C88259db9e66E1F3AA1"
    # "0xbcD6819A00DF6e7f7E6D5e073fF00A91bc876a9d"
    # "0x04bD6ED6408cB573419Fd763e3B7CeD57dE69bd5"
    # "0x7e312939980B2842B524D3418Aa9b7498054e39a"
    # "0x58b34E79D53CAcbbC9920477c5BeA55A832871fD"
    # "0x57684b647D4Cc6b151E7476355fcFdc174da7ECE"
    # "0xb38b0D08965654f11377c0C90F2338D63926C9B9"
    # "0x2A447FE46490b5086557cE6e7b0609f845E69ac2"
    # "0x920598318D0C48a19a9cBd26D86Aa0D8079b139A"
    # "0x5d51a2034c3A830b6e50620F210E6882D3620224"
    # "0xa3fD520CbA6f44fFC4437A74865cEa5d2f93ce06"
    # "0x7e571726fA7E734d8C6BFc335DF860f5b9286355"
    # "0x7cC2485c334a9c04F40cfc6e36CA8Be7F2a4efe1"
    # "0x23ed71A0D5a1583233115d25A22E96Cd30Fd8864"
    # "0x82d7503225F98B999CafDfbAab803D52f122dD2b"
    # "0x023E5D8740823bb19401Cbf561bf322EF93124f0"
    # "0x8b492eE2fBc146Ed845cBD05e4e2eB59bfE030f9"
    # "0xB17F63aeD263D6BE67d817053D664190FBa15A50"
    # "0x78808a499e163A5a88499F4F0d1f1457489F503c"
    # "0xA6899Cce1CEA2c2C921cCBcbad296feFD0C7A955"
    # "0x2f511975290121b5937A1Bbc836c256244723C9b"
    # "0x3Fc37A9989520747df339c7928F569f9BF798d00"
    # "0xC9ADF89F108992Af6094D0D217E09e54237250db"
    # "0x7Bc28C1bf423FD364994815bC4E82C596a5A375a"
    # "0xBa7F7D6A07Ae4F42F4adD5D360D9Ca6d41825073"
    # "0xeb6E02AD20e35Ad1F2266b98F703757B493BBccE"
    # "0xdFd21D8190f444437A5F791EF920b57ac43184ca"
    # "0x9f47F2b56A2767e01d15ED3c8d3Fb5283C5d5c80"
    # "0xcc824B6b022e53c564c60d16B1a4e4bb93851A75"
    # "0xa81dDe743030592237c6B3B6B3e55A9Bf15AbEe4"
    # "0x104E92e8F7aA38A6e2f5f52ADFf357Ab05738D71"
    # "0x1109bF8125a52fb8a92f1eE5CD3d9F988a80F954"
    # "0xAb71F6637623E3310940E6624355A094cC7c42E6"
    # "0x7cDe0a989C97a15b6f2b63F0b7582d40a4e86D23"
    # "0x16275C1cAE13131B153cec4f8178304C7AE730f4"
)

# ABI selector for `totalAssets()`
ABI="totalSupply()(uint256)"

# Table header
echo -e "Symbol\tContract Address\tTotal Assets"
echo "-----------------------------------------"

# ibera special case
ASSETS=$(cast call "$IBERA" "deposits()(uint256)" --rpc-url "$RPC_URL")
# Convert hex or scientific notation to decimal
ASSETS_DECIMAL=$(echo "$ASSETS" | awk '{printf "%.0f\n", $1}')

# Print formatted row
echo -e "iBERA\t$IBERA\t$ASSETS_DECIMAL"

# Loop through each address and get totalAssets()
for ADDRESS in "${ADDRESSES[@]}"; do
    ASSETS=$(cast call "$ADDRESS" "$ABI" --rpc-url "$RPC_URL")
    STAKING_TOKEN=$(cast call "$ADDRESS" "stakingToken()(address)" --rpc-url "$RPC_URL")
    SYMBOL=$(cast call $STAKING_TOKEN "symbol()(string)" --rpc-url $RPC_URL)
    SYMBOL=$(echo $SYMBOL | tr -d '"')

    # Convert hex or scientific notation to decimal
    ASSETS_DECIMAL=$(echo "$ASSETS" | awk '{printf "%.0f\n", $1}')
    if [[ $(( ASSETS_DECIMAL - 1000 )) == 0 ]]; then
        continue
    fi

    # Print formatted row
    echo -e "$SYMBOL\t$ADDRESS\t$ASSETS_DECIMAL"
done

# Print total sum
echo "-----------------------------------------"
