#!/bin/bash

set -euo pipefail

# expect PRIVATE_KEY in `.env`
source .env

# Change these to correct params
SENDER="0x1eCF087ea1194AB182A53De849d61deB917D733F"
AMOUNT_IBERA=100000000000000000
AMOUNT_BERA=100000000000000000
POOL_ID="0xf815673fd54b48a6767acd2791bd6885d94f3d500000000000000000000000c3" # iBERA stable pool id
POOL="0xf815673Fd54b48A6767acD2791BD6885D94F3D50"
AMOUNTS_IN="[$AMOUNT_BERA,$AMOUNT_IBERA,0]"

VAULT_ADDRESS="0x4Be03f781C497A489E3cB0287833452cA9B9E80B"
POOL_FACTORY="0xDfA30BDa0375d4763711AB0CC8D91B20bfCC87E1"
IBGT="0xac03CABA51e17c86c921E1f6CBFBdC91F8BB2E6b"
IBERA="0x9b6761bf2397Bb5a6624a856cC84A3A14Dcd3fe5"
WBERA="0x6969696969696969696969696969696969696969"

RPC_URL="https://rpc.berachain.com"

USER_DATA=$(cast abi-encode "func(uint256,uint256[])" 0 "$AMOUNTS_IN")


cast send --private-key $PRIVATE_KEY --rpc-url $RPC_URL $WBERA "deposit()" --value $AMOUNT_BERA

cast send --private-key $PRIVATE_KEY --rpc-url $RPC_URL $IBERA "approve(address,uint256)" $VAULT_ADDRESS $AMOUNT_IBERA

cast send --private-key $PRIVATE_KEY --rpc-url $RPC_URL $WBERA "approve(address,uint256)" $VAULT_ADDRESS $AMOUNT_BERA

# cast send --private-key $PRIVATE_KEY --rpc-url $RPC_URL $POOL "approve(address,uint256)" $VAULT_ADDRESS 115792089237316195423570985008687907853269984665640564039457584007913129639935

cast send $VAULT_ADDRESS "joinPool(bytes32,address,address,(address[],uint256[],bytes,bool))" \
    $POOL_ID \
    $SENDER \
    $SENDER \
    "([$WBERA, $IBERA, $POOL], [$AMOUNT_BERA,$AMOUNT_IBERA,115792089237316195423570985008687907853269984665640564039457584007913129639935], $USER_DATA, "false")" \
    --rpc-url $RPC_URL \
    --private-key $PRIVATE_KEY

    